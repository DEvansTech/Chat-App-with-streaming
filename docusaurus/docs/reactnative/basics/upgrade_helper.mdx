---
id: upgrading-from-v4
title: Upgrading from V4
---

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

This guide highlights the changes introduced from v4 to v5.

## Prop or Context Changes

The following values in [`ImageGalleryContext`](https://getstream.io/chat/docs/sdk/reactnative/v5/contexts/image-gallery-context/#value) have been renamed:

- `image` -> `selectedMessage`
- `setImage` -> `setSelectedMessage`
- `images` -> `messages`
- `setImages` -> `setMessages`

## Dependency Changes

- If you have installed `stream-chat` dependency explicitly in your application, then upgrade it to v7:

  ```bash
  yarn add stream-chat@7.0.0
  ```

- Replace [`@react-native-community/cameraroll`](https://github.com/react-native-cameraroll/react-native-cameraroll) dependency with [`@react-native-camera-roll/camera-roll`](https://www.npmjs.com/package/@react-native-camera-roll/camera-roll):

  ```bash
  yarn remove @react-native-community/cameraroll
  yarn add @react-native-camera-roll/camera-roll
  ```
  
## Unique Chat Component Instance

  Until v4, you could provide a separate `Chat` component for each usage of `Channel` component or `ChannelList` component.
  But from v5, you must provide only one instance of the `Chat` component within your application.
  This component needs to be a parent for all the chat-related components such as `ChannelList`, `Channel` or `Thread`.

## Enable Offline Support

Offline support is a major opt-in feature introduced in v5 of the Stream Chat React Native SDK.

> Offline support is currently not implemented for Expo package (stream-chat-expo).

The offline storage implementation currently offers the following features:

- Access to chat when Internet connection is disabled or low.
- Faster startup times and loading, since initial data is loaded from offline storage before performing any network requests.
- Syncing of the offline database using WebSocket events and Sync API.

The following features are currently **NOT** implemented. They will be implemented gradually as part of minor releases in v5.

- Optimistically update offline database during chat interactions, such as send message, add reaction, etc.
- Access to threads in offline mode.
- Offline caching of attachment images and profile images.

To enable offline support, please follow the given steps:

1. **Upgrade stream-chat dependency (optional)**

  If you have installed `stream-chat` dependency explicitly on your application, then upgrade it to v7:

  ```bash
  yarn add stream-chat@7.0.0
  ```

2. **Add `react-native-quick-sqlite` dependency**

  ```bash
  yarn add react-native-quick-sqlite
  npx pod-install
  ```

3. **Do not wait for `connectUser` call to succeed**

  It is important that you call the `connectUser` method on the chat client, before you render Chat components.
  But you don't need to wait for `connectUser` to succeed before rendering Chat components. This is to ensure:

  - Chat components have access to current user information, which is important to store/access offline data.
  - In case of slow or no network access, Chat components will still load the chat data without waiting for `connectUser` to succeed.

  ```tsx {7,8,16}
  const chatClient = StreamChat.getInstance('API_KEY');
  const App = () => {
    const [isClientReady, setIsClientReady] = useState(false);

    useEffect(() => {
      const startChat = async () => {
        const connectPromise = chatClient.connectUser(user, tokenOrTokenProvider);
        setIsClientReady(true); // this allows components to render
        await connectPromise();
        // Any other post-connectUser logic you may have goes here.
      };

      startChat();
    }, []);

    if (!isClientReady) return null; // or some loading indicator;

    return (
      <Chat client={chatClient} enableOfflineSupport>
        ...
      </Chat>
    );
  };
  ```

4. **Add `enableOfflineSupport` prop on Chat component**

  ```tsx
  import { Chat } from 'stream-chat-react-native';

  <Chat client={chatClient} enableOfflineSupport>
    ...
  </Chat>;
  ```

5. **Reset the database when signing out the user**

  Since the SDK doesn't handle app-level authentication logic, it's the application's responsibility
  to ensure the database is reset when a user gets logged out. This should generally be done before you
  call `client.disconnectUser()`.

  ```jsx
  import { QuickSqliteClient } from 'stream-chat-react-native';

  // Sign out logic
  QuickSqliteClient.resetDB();
  chatClient.disconnectUser();
  ```
